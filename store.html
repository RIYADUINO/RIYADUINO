<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIYADUINO | Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Plus+Jakarta+Sans:wght@300;400;600&family=IBM+Plex+Sans+Arabic:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        /* --- RESTORING ARABIC FONT FROM MAIN PAGE --- */
        @font-face {
            font-family: 'Badeen Display';
            src: url('fonts/BadeenDisplay-Regular.woff2') format('woff2'); 
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        /* --- THEME STYLES --- */
        :root {
            --bg-deep: #050505;
            --bg-panel: #0E0E0E;
            --gold-primary: #FFD700;
            --gold-glow: rgba(255, 215, 0, 0.6);
            --text-white: #ffffff;
            --text-grey: #999999;
            --border-tech: 1px solid rgba(255, 255, 255, 0.1);
            --font-main: 'Plus Jakarta Sans', sans-serif;
            --font-arabic-body: 'IBM Plex Sans Arabic', sans-serif;
            --font-arabic-cool: 'Badeen Display', sans-serif; /* Added to match Home */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg-deep); color: var(--text-white); font-family: var(--font-main); position: relative; overflow-x: hidden; }
        
        /* --- ANIMATIONS --- */
        @keyframes glow-pulse {
            0% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.2); }
            50% { text-shadow: 0 0 20px var(--gold-glow); }
            100% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.2); }
        }
        
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Navigation */
        nav {
            position: sticky; top: 15px; margin: 15px auto; max-width: 1200px; width: 92%;
            background: rgba(14, 14, 14, 0.85); backdrop-filter: blur(15px);
            border: var(--border-tech); border-radius: 15px; padding: 12px 25px;
            display: flex; justify-content: space-between; align-items: center; z-index: 1000;
            transition: 0.3s;
        }
        nav:hover { border-color: var(--gold-primary); box-shadow: 0 0 15px rgba(255,215,0,0.1); }

        .logo { font-family: 'Orbitron', sans-serif; font-weight: 800; font-size: 1.4rem; color: #fff; text-decoration: none; }
        .logo span { color: var(--gold-primary); animation: glow-pulse 3s infinite; }
        
        .nav-links { display: flex; align-items: center; }
        .nav-links a { color: #fff; text-decoration: none; font-size: 0.75rem; font-weight: 700; margin-left: 20px; transition: 0.3s; }
        .nav-links a:hover { color: var(--gold-primary); text-shadow: 0 0 8px var(--gold-primary); transform: scale(1.05); }
        .lang-btn { background: none; border: 1px solid #444; color: #fff; padding: 5px 12px; cursor: pointer; margin-left: 15px; border-radius: 5px; transition: 0.3s; }
        .lang-btn:hover { border-color: var(--gold-primary); color: var(--gold-primary); }

        .cart-icon { cursor: pointer; position: relative; margin-left: 20px; transition: 0.3s; }
        .cart-icon:hover { transform: scale(1.1); filter: drop-shadow(0 0 5px var(--gold-primary)); }
        .cart-count { 
            position: absolute; top: -8px; right: -10px; background: var(--gold-primary); color: #000; 
            font-size: 0.7rem; font-weight: bold; width: 18px; height: 18px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-family: 'Orbitron';
        }

        /* Store Layout */
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        
        .store-header { text-align: center; margin-bottom: 50px; animation: slideUpFade 1s ease-out; }
        .store-header h1 { 
            font-family: 'Orbitron', sans-serif; color: var(--gold-primary); font-size: 2.5rem; margin-bottom: 10px; 
            animation: glow-pulse 3s infinite alternate;
        }
        
        /* Loading Spinner */
        #loader { text-align: center; color: var(--gold-primary); font-family: 'Orbitron', sans-serif; margin-top: 50px; animation: glow-pulse 1s infinite; }

        /* Grid */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }

        /* Product Card */
        .product-card {
            background: var(--bg-panel); border: var(--border-tech); border-radius: 15px; overflow: hidden;
            transition: all 0.3s ease; display: flex; flex-direction: column;
            animation: slideUpFade 0.8s ease-out backwards;
        }
        /* Stagger animation delay via JS or CSS logic (using simple delay here for simplicity) */
        .product-card:nth-child(1) { animation-delay: 0.1s; }
        .product-card:nth-child(2) { animation-delay: 0.2s; }
        .product-card:nth-child(3) { animation-delay: 0.3s; }
        .product-card:nth-child(4) { animation-delay: 0.4s; }

        .product-card:hover { transform: translateY(-10px); border-color: var(--gold-primary); box-shadow: 0 10px 30px rgba(0,0,0,0.6); }

        .img-box { height: 220px; width: 100%; background: #000; position: relative; overflow: hidden; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .product-card:hover .img-box img { transform: scale(1.1); }
        
        /* Badges */
        .status-badge {
            position: absolute; top: 10px; right: 10px; padding: 4px 10px; font-size: 0.7rem; font-weight: bold; border-radius: 4px; z-index: 2;
        }
        .in-stock-badge { background: #00ff41; color: #000; box-shadow: 0 0 10px rgba(0,255,65,0.4); }
        .out-stock-badge { background: #ff003c; color: #fff; box-shadow: 0 0 10px rgba(255,0,60,0.4); }

        .p-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .p-title { font-family: 'Orbitron', sans-serif; font-size: 1.1rem; margin-bottom: 8px; color: #fff; }
        .p-desc { color: var(--text-grey); font-size: 0.85rem; margin-bottom: 15px; flex-grow: 1; line-height: 1.5; }
        .p-price { font-size: 1.25rem; color: var(--gold-primary); font-weight: 700; margin-bottom: 15px; text-shadow: 0 0 5px rgba(255,215,0,0.3); }
        
        /* Animated Button */
        .buy-btn {
            width: 100%; padding: 12px; border: none; font-weight: 700; cursor: pointer; border-radius: 6px; 
            font-family: 'Orbitron', sans-serif; letter-spacing: 1px; transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        .buy-btn.active { background: #fff; color: #000; }
        .buy-btn.active::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,215,0,0.5), transparent);
            transition: 0.5s;
        }
        .buy-btn.active:hover { 
            background: var(--gold-primary); transform: scale(1.03); 
            box-shadow: 0 0 15px var(--gold-primary); 
        }
        .buy-btn.active:hover::before { left: 100%; }

        .buy-btn.disabled { background: #222; color: #555; cursor: not-allowed; border: 1px solid #333; }

        /* --- CART MODAL & CHECKOUT --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; z-index: 2000;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background: #111; width: 95%; max-width: 500px; padding: 30px; border-radius: 15px;
            border: 1px solid var(--gold-primary); position: relative;
            max-height: 90vh; overflow-y: auto;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
        }
        .close-modal { position: absolute; top: 15px; right: 20px; color: #fff; font-size: 1.5rem; cursor: pointer; transition: 0.3s; }
        .close-modal:hover { color: var(--gold-primary); transform: rotate(90deg); }
        
        .modal-title { font-family: 'Orbitron'; color: var(--gold-primary); margin-bottom: 20px; font-size: 1.4rem; text-align: center; animation: glow-pulse 3s infinite; }

        /* Cart Items List */
        .cart-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding: 10px 0; }
        .cart-item-info h4 { font-size: 0.9rem; color: #fff; }
        .cart-item-info p { color: var(--gold-primary); font-size: 0.8rem; }
        
        .qty-controls { display: flex; align-items: center; gap: 10px; }
        .qty-btn { background: #333; color: #fff; border: none; padding: 2px 8px; cursor: pointer; border-radius: 4px; transition: 0.3s; }
        .qty-btn:hover { background: var(--gold-primary); color: #000; }
        
        /* Checkout Form */
        .checkout-form { margin-top: 25px; border-top: 1px solid var(--gold-primary); padding-top: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #aaa; font-size: 0.8rem; margin-bottom: 5px; }
        .form-input { 
            width: 100%; padding: 12px; background: #0a0a0a; border: 1px solid #444; 
            color: #fff; border-radius: 6px; font-family: var(--font-main); transition: 0.3s;
        }
        .form-input:focus { outline: none; border-color: var(--gold-primary); box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        
        /* Error Styling */
        .form-input.error { border-color: #ff3333; box-shadow: 0 0 5px rgba(255, 51, 51, 0.5); }
        .error-msg { color: #ff3333; font-size: 0.75rem; margin-top: 4px; display: none; }
        
        .coupon-box { display: flex; gap: 10px; margin-bottom: 15px; }
        .checkout-btn { 
            width: 100%; padding: 14px; background: var(--gold-primary); color: #000; 
            font-weight: 900; border: none; border-radius: 6px; cursor: pointer; 
            font-family: 'Orbitron'; margin-top: 10px; transition: 0.3s; 
        }
        .checkout-btn:hover { background: #fff; box-shadow: 0 0 20px var(--gold-primary); transform: scale(1.02); }
        
        /* Mobile Responsive */
        @media(max-width: 768px) { .nav-links a:not(.lang-btn) { display: none; } }
        
        /* --- ARABIC HANDLING (MATCHED TO HOME) --- */
        body.rtl { direction: rtl; text-align: right; }
        body.rtl .nav-links a { margin-left: 0; margin-right: 20px; }
        body.rtl .cart-icon { margin-left: 0; margin-right: 20px; }
        
        /* Apply Cool Arabic Font to Titles */
        body.rtl h1, body.rtl h2, body.rtl h3, body.rtl .logo, body.rtl .modal-title, body.rtl .store-header h1 {
            font-family: var(--font-arabic-cool);
            font-weight: 400;
            letter-spacing: 0;
            line-height: 1.2;
        }
        body.rtl .checkout-btn, body.rtl .buy-btn {
            font-family: var(--font-arabic-body);
            font-weight: 700;
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo-wrap">
            <a href="index.html" class="logo">RIYAD<span>UINO</span></a>
        </div>
        <div class="nav-links">
            <a href="index.html" data-en="HOME" data-ar="الرئيسية">HOME</a>
            <a href="#" class="active" style="color:var(--gold-primary);">STORE</a>
            <button class="lang-btn" onclick="toggleLang()">EN/AR</button>
            <div class="cart-icon" onclick="toggleCart()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <div class="cart-count" id="cartCount">0</div>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="store-header">
            <h1 data-en="STORE" data-ar="المتجر">STORE</h1>
        </div>

        <div id="loader">LOADING PRODUCTS... / جاري تحميل المنتجات...</div>
        <div class="products-grid" id="productsGrid"></div>
    </div>

    <div class="modal-overlay" id="cartModal">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleCart()">&times;</span>
            <h2 class="modal-title" data-en="YOUR CART" data-ar="سلة المشتريات">YOUR CART</h2>
            
            <div id="cartItemsList">
                <p style="text-align: center; color: #777;">Cart is empty.</p>
            </div>

            <form action="https://formspree.io/f/xzzkyzzp" method="POST" class="checkout-form" id="orderForm" novalidate onsubmit="return validateAndSubmit(event)">
                
                <h3 style="color: #fff; margin-bottom: 15px; font-family: 'Orbitron';" data-en="CHECKOUT DETAILS" data-ar="بيانات الطلب">CHECKOUT DETAILS</h3>

                <input type="hidden" name="Order Details" id="hiddenOrderData">

                <div class="form-group">
                    <input type="text" name="name" class="form-input" placeholder="Full Name / الاسم الكامل" required>
                    <div class="error-msg" data-en="Please enter your name" data-ar="الرجاء إدخال الاسم">Please enter your name</div>
                </div>

                <div class="form-group">
                    <input type="email" name="email" class="form-input" placeholder="Email Address / البريد الإلكتروني" required>
                    <div class="error-msg" data-en="Please enter a valid email" data-ar="الرجاء إدخال بريد صحيح">Please enter a valid email</div>
                </div>

                <div class="form-group">
                    <input type="tel" name="phone" class="form-input" placeholder="Phone Number / رقم الجوال" required>
                    <div class="error-msg" data-en="Phone number is required" data-ar="رقم الجوال مطلوب">Phone number is required</div>
                </div>

                <div class="form-group coupon-box">
                    <input type="text" name="coupon" class="form-input" placeholder="Coupon Code / كود الخصم" style="margin-bottom: 0;">
                </div>

                <button type="submit" class="checkout-btn" data-en="PLACE ORDER" data-ar="إتمام الطلب">PLACE ORDER</button>
            </form>
        </div>
    </div>

    <script>
        // ==========================================================
        // CONFIGURATION: GOOGLE SHEET CSV LINK
        // ==========================================================
        const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTBQd3LUgZKxeuRQA2B0Cj3IvJBSSS0VL2vnmtOryQxFsAK-Kikg_NZTVGtlYghB96yFYyvqXrPGJEu/pub?output=csv";
        
        // GLOBAL VARIABLES
        let allProducts = [];
        let cart = [];
        let currentLang = 'en';

        const grid = document.getElementById('productsGrid');
        const loader = document.getElementById('loader');

        // 1. Fetch Data
        function loadProducts() {
            Papa.parse(sheetURL, {
                download: true, header: true,
                complete: function(results) {
                    allProducts = results.data;
                    renderProducts(allProducts);
                    loader.style.display = 'none';
                },
                error: function(err) {
                    loader.innerHTML = "Error loading store database.";
                }
            });
        }

        // 2. Render Cards
        function renderProducts(products) {
            grid.innerHTML = "";
            products.forEach((product, index) => {
                if(!product.name) return;
                const isStock = product.instock && product.instock.toUpperCase().trim() === 'TRUE';
                const badgeClass = isStock ? 'in-stock-badge' : 'out-stock-badge';
                const badgeText = isStock ? 'IN STOCK' : 'SOLD OUT';
                const imgUrl = product.image ? product.image : 'https://placehold.co/400x300/000000/FFF?text=No+Image';

                let btnHtml = "";
                if(isStock) {
                    btnHtml = `<button class="buy-btn active" onclick="addToCart(${index})">${currentLang === 'en' ? 'ADD TO CART' : 'أضف للسلة'}</button>`;
                } else {
                    btnHtml = `<button class="buy-btn disabled">${currentLang === 'en' ? 'OUT OF STOCK' : 'نفذت الكمية'}</button>`;
                }

                // Add animation delay based on index
                const delay = index * 0.1;

                const html = `
                    <div class="product-card" style="animation-delay: ${delay}s">
                        <div class="img-box">
                            <img src="${imgUrl}" alt="${product.name}">
                            <div class="status-badge ${badgeClass}">${badgeText}</div>
                        </div>
                        <div class="p-info">
                            <div class="p-title">${product.name}</div>
                            <div class="p-desc">${product.description}</div>
                            <div class="p-price">${product.price}</div>
                            ${btnHtml}
                        </div>
                    </div>
                `;
                grid.innerHTML += html;
            });
        }

        // 3. CART LOGIC
        function addToCart(index) {
            const product = allProducts[index];
            const existingItem = cart.find(item => item.id === index);

            if(existingItem) {
                existingItem.qty++;
            } else {
                cart.push({
                    id: index,
                    name: product.name,
                    price: product.price,
                    qty: 1
                });
            }
            updateCartUI();
            toggleCart(); // Auto open cart
        }

        function updateQty(id, change) {
            const item = cart.find(i => i.id === id);
            if(item) {
                item.qty += change;
                if(item.qty <= 0) {
                    cart = cart.filter(i => i.id !== id);
                }
                updateCartUI();
            }
        }

        function updateCartUI() {
            const cartList = document.getElementById('cartItemsList');
            const cartCount = document.getElementById('cartCount');
            
            const totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
            cartCount.innerText = totalQty;

            if(cart.length === 0) {
                cartList.innerHTML = `<p style="text-align: center; color: #777; margin: 20px 0;">${currentLang === 'en' ? 'Cart is empty.' : 'السلة فارغة.'}</p>`;
                return;
            }

            let html = '';
            cart.forEach(item => {
                html += `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <p>${item.price}</p>
                    </div>
                    <div class="qty-controls">
                        <button class="qty-btn" onclick="updateQty(${item.id}, -1)">-</button>
                        <span style="color:#fff; min-width: 20px; text-align:center;">${item.qty}</span>
                        <button class="qty-btn" onclick="updateQty(${item.id}, 1)">+</button>
                    </div>
                </div>`;
            });
            cartList.innerHTML = html;
        }

        // 4. MODAL & FORM HANDLING
        function toggleCart() {
            const modal = document.getElementById('cartModal');
            modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        }

        function validateAndSubmit(e) {
            const form = document.getElementById('orderForm');
            const inputs = form.querySelectorAll('input[required]');
            let isValid = true;

            inputs.forEach(input => {
                input.classList.remove('error');
                if(input.nextElementSibling && input.nextElementSibling.classList.contains('error-msg')) {
                    input.nextElementSibling.style.display = 'none';
                }
            });

            inputs.forEach(input => {
                if(!input.value.trim()) {
                    isValid = false;
                    input.classList.add('error');
                    if(input.nextElementSibling && input.nextElementSibling.classList.contains('error-msg')) {
                        input.nextElementSibling.style.display = 'block';
                    }
                }
            });

            if(cart.length === 0) {
                alert(currentLang === 'en' ? "Your cart is empty!" : "السلة فارغة!");
                e.preventDefault();
                return false;
            }

            if(isValid) {
                let orderString = "--- ORDER SUMMARY ---\n";
                cart.forEach(item => {
                    orderString += `- ${item.name} (x${item.qty}) @ ${item.price}\n`;
                });
                document.getElementById('hiddenOrderData').value = orderString;
                return true;
            } else {
                e.preventDefault();
                return false;
            }
        }

        // 5. LANGUAGE TOGGLE
        function toggleLang() {
            currentLang = currentLang === 'en' ? 'ar' : 'en';
            document.body.classList.toggle('rtl', currentLang === 'ar');
            
            document.querySelectorAll('[data-en]').forEach(el => {
                if(el.tagName === 'INPUT') return;
                el.innerText = el.getAttribute(`data-${currentLang}`);
            });

            document.querySelectorAll('.error-msg').forEach(msg => {
                msg.innerText = msg.getAttribute(`data-${currentLang}`);
            });

            renderProducts(allProducts);
            updateCartUI();
        }

        loadProducts();
    </script>
</body>
</html>
